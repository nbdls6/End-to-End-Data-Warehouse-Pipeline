{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-01T21:12:50.237272Z", "invocation_id": "e465e1bb-c094-4ea3-aa4f-7bc28f1b34e3", "invocation_started_at": "2025-12-01T21:12:42.220716Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:12:45.143691Z", "completed_at": "2025-12-01T21:12:45.156664Z"}, {"name": "execute", "started_at": "2025-12-01T21:12:45.157332Z", "completed_at": "2025-12-01T21:12:45.718670Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.5761158466339111, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c458-0307-2a4d-000e-9ce300b440ba"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.nba_dw_project.stg_nba_stats", "compiled": true, "compiled_code": "\n\nWITH raw_data AS (\n    SELECT *\n    FROM MLDS430.MARMOT_FINAL.RAW_NBA_STATS\n    WHERE \"Year\" >= 1984  -- Filter for years 1984 and later\n      AND \"Year\" IS NOT NULL\n      AND \"Player\" IS NOT NULL\n),\n\n-- Step 1: Drop 'Unnamed:_0' and blank columns, clean data\ncleaned_data AS (\n    SELECT \n        CAST(\"Year\" AS INTEGER) as season_year,\n        \"Player\" as player_name,\n        \"Pos\" as position,\n        CAST(\"Age\" AS FLOAT) as age,\n        \"Tm\" as team_code,\n        CAST(\"G\" AS FLOAT) as games_played,\n        CAST(\"GS\" AS FLOAT) as games_started,\n        CAST(\"MP\" AS FLOAT) as minutes_played,\n        CAST(\"PER\" AS FLOAT) as player_efficiency_rating,\n        CAST(\"TS_PCT\" AS FLOAT) as true_shooting_pct,\n        CAST(\"ThreePAr\" AS FLOAT) as three_point_attempt_rate,\n        CAST(\"FTr\" AS FLOAT) as free_throw_rate,\n        CAST(\"ORB_PCT\" AS FLOAT) as offensive_rebound_pct,\n        CAST(\"DRB_PCT\" AS FLOAT) as defensive_rebound_pct,\n        CAST(\"TRB_PCT\" AS FLOAT) as total_rebound_pct,\n        CAST(\"AST_PCT\" AS FLOAT) as assist_pct,\n        CAST(\"STL_PCT\" AS FLOAT) as steal_pct,\n        CAST(\"BLK_PCT\" AS FLOAT) as block_pct,\n        CAST(\"TOV_PCT\" AS FLOAT) as turnover_pct,\n        CAST(\"USG_PCT\" AS FLOAT) as usage_pct,\n        CAST(\"OWS\" AS FLOAT) as offensive_win_shares,\n        CAST(\"DWS\" AS FLOAT) as defensive_win_shares,\n        CAST(\"WS\" AS FLOAT) as win_shares,\n        CAST(\"WS_48\" AS FLOAT) as win_shares_per_48,\n        CAST(\"OBPM\" AS FLOAT) as offensive_box_plus_minus,\n        CAST(\"DBPM\" AS FLOAT) as defensive_box_plus_minus,\n        CAST(\"BPM\" AS FLOAT) as box_plus_minus,\n        CAST(\"VORP\" AS FLOAT) as value_over_replacement_player,\n        CAST(\"FG\" AS FLOAT) as field_goals,\n        CAST(\"FGA\" AS FLOAT) as field_goal_attempts,\n        CAST(\"FG_PCT\" AS FLOAT) as field_goal_pct,\n        CAST(\"ThreeP\" AS FLOAT) as three_pointers,\n        CAST(\"ThreePA\" AS FLOAT) as three_point_attempts,\n        CAST(\"ThreeP_PCT\" AS FLOAT) as three_point_pct,\n        CAST(\"TwoP\" AS FLOAT) as two_pointers,\n        CAST(\"TwoPA\" AS FLOAT) as two_point_attempts,\n        CAST(\"TwoP_PCT\" AS FLOAT) as two_point_pct,\n        CAST(\"eFG_PCT\" AS FLOAT) as effective_field_goal_pct,\n        CAST(\"FT\" AS FLOAT) as free_throws,\n        CAST(\"FTA\" AS FLOAT) as free_throw_attempts,\n        CAST(\"FT_PCT\" AS FLOAT) as free_throw_pct,\n        CAST(\"ORB\" AS FLOAT) as offensive_rebounds,\n        CAST(\"DRB\" AS FLOAT) as defensive_rebounds,\n        CAST(\"TRB\" AS FLOAT) as total_rebounds,\n        CAST(\"AST\" AS FLOAT) as assists,\n        CAST(\"STL\" AS FLOAT) as steals,\n        CAST(\"BLK\" AS FLOAT) as blocks,\n        CAST(\"TOV\" AS FLOAT) as turnovers,\n        CAST(\"PF\" AS FLOAT) as personal_fouls,\n        CAST(\"PTS\" AS FLOAT) as points,\n        CURRENT_TIMESTAMP() as extraction_timestamp\n    FROM raw_data\n    -- Filter out rows where key stats are all null\n    WHERE (\"PTS\" IS NOT NULL OR \"AST\" IS NOT NULL OR \"TRB\" IS NOT NULL)\n),\n\n-- Step 2 & 3: Consolidate players with multiple teams in same season\n-- Group by Year and Player, aggregate numeric stats (average), take first team/position/age\nranked_data AS (\n    SELECT \n        season_year,\n        player_name,\n        position,\n        age,\n        team_code,\n        games_played,\n        games_started,\n        minutes_played,\n        player_efficiency_rating,\n        true_shooting_pct,\n        three_point_attempt_rate,\n        free_throw_rate,\n        offensive_rebound_pct,\n        defensive_rebound_pct,\n        total_rebound_pct,\n        assist_pct,\n        steal_pct,\n        block_pct,\n        turnover_pct,\n        usage_pct,\n        offensive_win_shares,\n        defensive_win_shares,\n        win_shares,\n        win_shares_per_48,\n        offensive_box_plus_minus,\n        defensive_box_plus_minus,\n        box_plus_minus,\n        value_over_replacement_player,\n        field_goals,\n        field_goal_attempts,\n        field_goal_pct,\n        three_pointers,\n        three_point_attempts,\n        three_point_pct,\n        two_pointers,\n        two_point_attempts,\n        two_point_pct,\n        effective_field_goal_pct,\n        free_throws,\n        free_throw_attempts,\n        free_throw_pct,\n        offensive_rebounds,\n        defensive_rebounds,\n        total_rebounds,\n        assists,\n        steals,\n        blocks,\n        turnovers,\n        personal_fouls,\n        points,\n        extraction_timestamp,\n        ROW_NUMBER() OVER (PARTITION BY season_year, player_name ORDER BY extraction_timestamp) as rn\n    FROM cleaned_data\n),\n\nconsolidated AS (\n    SELECT \n        season_year,\n        player_name,\n        -- Take first value for categorical fields\n        MAX(CASE WHEN rn = 1 THEN position END) as position,\n        MAX(CASE WHEN rn = 1 THEN age END) as age,\n        MAX(CASE WHEN rn = 1 THEN team_code END) as team_code,\n        -- Average numeric statistics for multi-team players\n        AVG(games_played) as games_played,\n        AVG(games_started) as games_started,\n        AVG(minutes_played) as minutes_played,\n        AVG(player_efficiency_rating) as player_efficiency_rating,\n        AVG(true_shooting_pct) as true_shooting_pct,\n        AVG(three_point_attempt_rate) as three_point_attempt_rate,\n        AVG(free_throw_rate) as free_throw_rate,\n        AVG(offensive_rebound_pct) as offensive_rebound_pct,\n        AVG(defensive_rebound_pct) as defensive_rebound_pct,\n        AVG(total_rebound_pct) as total_rebound_pct,\n        AVG(assist_pct) as assist_pct,\n        AVG(steal_pct) as steal_pct,\n        AVG(block_pct) as block_pct,\n        AVG(turnover_pct) as turnover_pct,\n        AVG(usage_pct) as usage_pct,\n        AVG(offensive_win_shares) as offensive_win_shares,\n        AVG(defensive_win_shares) as defensive_win_shares,\n        AVG(win_shares) as win_shares,\n        AVG(win_shares_per_48) as win_shares_per_48,\n        AVG(offensive_box_plus_minus) as offensive_box_plus_minus,\n        AVG(defensive_box_plus_minus) as defensive_box_plus_minus,\n        AVG(box_plus_minus) as box_plus_minus,\n        AVG(value_over_replacement_player) as value_over_replacement_player,\n        AVG(field_goals) as field_goals,\n        AVG(field_goal_attempts) as field_goal_attempts,\n        AVG(field_goal_pct) as field_goal_pct,\n        AVG(three_pointers) as three_pointers,\n        AVG(three_point_attempts) as three_point_attempts,\n        AVG(three_point_pct) as three_point_pct,\n        AVG(two_pointers) as two_pointers,\n        AVG(two_point_attempts) as two_point_attempts,\n        AVG(two_point_pct) as two_point_pct,\n        AVG(effective_field_goal_pct) as effective_field_goal_pct,\n        AVG(free_throws) as free_throws,\n        AVG(free_throw_attempts) as free_throw_attempts,\n        AVG(free_throw_pct) as free_throw_pct,\n        AVG(offensive_rebounds) as offensive_rebounds,\n        AVG(defensive_rebounds) as defensive_rebounds,\n        AVG(total_rebounds) as total_rebounds,\n        AVG(assists) as assists,\n        AVG(steals) as steals,\n        AVG(blocks) as blocks,\n        AVG(turnovers) as turnovers,\n        AVG(personal_fouls) as personal_fouls,\n        AVG(points) as points,\n        MAX(extraction_timestamp) as extraction_timestamp\n    FROM ranked_data\n    GROUP BY season_year, player_name\n)\n\nSELECT *\nFROM consolidated", "relation_name": "MLDS430.MARMOT_FINAL.stg_nba_stats", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:12:45.725309Z", "completed_at": "2025-12-01T21:12:45.733299Z"}, {"name": "execute", "started_at": "2025-12-01T21:12:45.734177Z", "completed_at": "2025-12-01T21:12:48.004707Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.2806975841522217, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c458-0307-2a4c-000e-9ce300b4907a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.nba_dw_project.fact_player_season", "compiled": true, "compiled_code": "\n\nSELECT \n    season_year,\n    player_name,\n    position,\n    age,\n    team_code,\n    games_played,\n    games_started,\n    minutes_played,\n    \n    -- Core Statistics\n    points,\n    assists,\n    total_rebounds,\n    steals,\n    blocks,\n    turnovers,\n    personal_fouls,\n    \n    -- Shooting Stats\n    field_goals,\n    field_goal_attempts,\n    field_goal_pct,\n    three_pointers,\n    three_point_attempts,\n    three_point_pct,\n    two_pointers,\n    two_point_attempts,\n    two_point_pct,\n    effective_field_goal_pct,\n    free_throws,\n    free_throw_attempts,\n    free_throw_pct,\n    \n    -- Rebounding\n    offensive_rebounds,\n    defensive_rebounds,\n    \n    -- Per-Game Metrics (CALCULATED)\n    CASE WHEN games_played > 0 THEN points / games_played ELSE NULL END as points_per_game,\n    CASE WHEN games_played > 0 THEN assists / games_played ELSE NULL END as assists_per_game,\n    CASE WHEN games_played > 0 THEN total_rebounds / games_played ELSE NULL END as rebounds_per_game,\n    CASE WHEN games_played > 0 THEN steals / games_played ELSE NULL END as steals_per_game,\n    CASE WHEN games_played > 0 THEN blocks / games_played ELSE NULL END as blocks_per_game,\n    CASE WHEN games_played > 0 THEN turnovers / games_played ELSE NULL END as turnovers_per_game,\n    \n    -- Per-36 Minutes Metrics (CALCULATED)\n    CASE WHEN minutes_played > 0 THEN (points / minutes_played) * 36 ELSE NULL END as points_per_36min,\n    CASE WHEN minutes_played > 0 THEN (assists / minutes_played) * 36 ELSE NULL END as assists_per_36min,\n    CASE WHEN minutes_played > 0 THEN (total_rebounds / minutes_played) * 36 ELSE NULL END as rebounds_per_36min,\n    CASE WHEN minutes_played > 0 THEN (steals / minutes_played) * 36 ELSE NULL END as steals_per_36min,\n    CASE WHEN minutes_played > 0 THEN (blocks / minutes_played) * 36 ELSE NULL END as blocks_per_36min,\n    \n    extraction_timestamp\nFROM MLDS430.MARMOT_FINAL.stg_nba_stats", "relation_name": "MLDS430.MARMOT_FINAL.fact_player_season", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:12:48.009718Z", "completed_at": "2025-12-01T21:12:48.019493Z"}, {"name": "execute", "started_at": "2025-12-01T21:12:48.020263Z", "completed_at": "2025-12-01T21:12:50.013400Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.0051767826080322, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c458-0307-2a57-000e-9ce300b4c09e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.nba_dw_project.fact_player_season_advanced", "compiled": true, "compiled_code": "\n\nSELECT \n    season_year,\n    player_name,\n    position,\n    age,\n    team_code,\n    \n    -- Advanced Efficiency Metrics\n    player_efficiency_rating as PER,\n    true_shooting_pct as TS_PCT,\n    three_point_attempt_rate as ThreePAr,\n    free_throw_rate as FTr,\n    effective_field_goal_pct as eFG_PCT,\n    \n    -- Percentage Stats\n    offensive_rebound_pct as ORB_PCT,\n    defensive_rebound_pct as DRB_PCT,\n    total_rebound_pct as TRB_PCT,\n    assist_pct as AST_PCT,\n    steal_pct as STL_PCT,\n    block_pct as BLK_PCT,\n    turnover_pct as TOV_PCT,\n    usage_pct as USG_PCT,\n    \n    -- Win Shares\n    offensive_win_shares as OWS,\n    defensive_win_shares as DWS,\n    win_shares as WS,\n    win_shares_per_48 as WS_48,\n    \n    -- Plus/Minus Metrics\n    offensive_box_plus_minus as OBPM,\n    defensive_box_plus_minus as DBPM,\n    box_plus_minus as BPM,\n    value_over_replacement_player as VORP,\n    \n    -- Calculated Efficiency Ratios (need base fields from staging)\n    CASE WHEN turnovers > 0 THEN assists / turnovers ELSE NULL END as assist_to_turnover_ratio,\n    CASE WHEN personal_fouls > 0 THEN points / personal_fouls ELSE NULL END as points_per_foul,\n    CASE WHEN field_goal_attempts > 0 THEN points / field_goal_attempts ELSE NULL END as points_per_fga,\n    \n    -- Usage and Efficiency Combined\n    CASE \n        WHEN minutes_played > 0 AND games_played > 0 \n        THEN (minutes_played / (games_played * 48)) * 100 \n        ELSE NULL \n    END as minutes_usage_rate,\n    \n    -- Base fields needed for calculations (from staging)\n    assists,\n    turnovers,\n    points,\n    personal_fouls,\n    field_goal_attempts,\n    minutes_played,\n    games_played,\n    \n    extraction_timestamp\nFROM MLDS430.MARMOT_FINAL.stg_nba_stats", "relation_name": "MLDS430.MARMOT_FINAL.fact_player_season_advanced", "batch_results": null}], "elapsed_time": 6.323142766952515, "args": {"cache_selected_only": false, "state_modified_compare_vars": false, "which": "run", "warn_error_options": {"error": [], "warn": [], "silence": []}, "print": true, "version_check": true, "write_json": true, "invocation_command": "dbt run --profiles-dir .", "validate_macro_args": false, "log_level_file": "debug", "log_file_max_bytes": 10485760, "populate_cache": true, "require_all_warnings_handled_by_warn_error": false, "exclude": [], "log_level": "info", "empty": false, "partial_parse": true, "require_batched_execution_for_custom_microbatch_strategy": false, "use_colors": true, "static_parser": true, "vars": {}, "require_resource_names_without_spaces": true, "upload_to_artifacts_ingest_api": false, "partial_parse_file_diff": true, "show_resource_report": false, "indirect_selection": "eager", "select": [], "source_freshness_run_project_hooks": true, "quiet": false, "profiles_dir": ".", "introspect": true, "require_yaml_configuration_for_mf_time_spines": false, "log_path": "/usr/local/airflow/include/nba_dw_project/logs", "use_fast_test_edges": false, "skip_nodes_if_on_run_start_fails": false, "show_all_deprecations": false, "require_nested_cumulative_type_params": false, "strict_mode": false, "require_generic_test_arguments_property": true, "use_colors_file": true, "defer": false, "printer_width": 80, "favor_state": false, "log_format": "default", "require_explicit_package_overrides_for_builtin_materializations": true, "send_anonymous_usage_stats": true, "state_modified_compare_more_unrendered_values": false, "project_dir": "/usr/local/airflow/include/nba_dw_project", "macro_debugging": false, "log_format_file": "debug"}}